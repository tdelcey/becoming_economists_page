---
title: "Documentation: the French database"
author: 
  - name: "Thomas Delcey"
    affiliation: "Université de Bourgogne"
    email: "Thomas.delcey@u-bourgogne.fr"
  - name: "Aurelien Goutsmedt"
    affiliation: "UC Louvain; ICHEC"
    email: "" 
format: html
page-layout: full
toc: true
toc_float: true
date: "2024"
date-format: "YYYY"
execute:
 echo: false
 warning: false
 message: false
---

![](picture.png)


```{r}
#| echo: FALSE 
#| results: "hide"
#| warning: FALSE
#| message: FALSE
#| error: FALSE

package_list <- c("pacman", #loading packages
                  "here", # building clearer paths
                  "tidyverse",
                  "cli", # for managing alerts and messages
                  "glue", # for string interpolation
                  "data.table",
                  "janitor", # cleaning column names of import csv
                #  "arrow", # compressing large data base
                # "humaniformat", # finding first name and surname for cleaning names,
                  "stringi" 
                #  "stringdist" 
              )

for (p in package_list) {
  if (p %in% installed.packages() == FALSE) {
    install.packages(p, dependencies = TRUE)
  }
  library(p, character.only = TRUE)
}

#### PATH ####

#original text path stored in google drive 
if(str_detect(getwd(), "tunex")){
  data_path <- "G:/Mon Drive/Phd_Project/data"
} else {
  if(str_detect(getwd(), "Admin")) {
    data_path <- "G:/.shortcut-targets-by-id/1Lhjzr0rDBjblTPYh9PoVBsi_uupV9z8L/Phd_Project/data"
  } else {
  if(str_detect(getwd(), "thomd")) {
    data_path <- "G:/.shortcut-targets-by-id/1Lhjzr0rDBjblTPYh9PoVBsi_uupV9z8L/Phd_Project/data"
    } else {
      data_path <- "G:/.shortcut-targets-by-id/1Lhjzr0rDBjblTPYh9PoVBsi_uupV9z8L/Phd_Project/data"
    }}
    print(paste("The path for data is", data_path))
  }

# data type
raw_data_path <- here(data_path, "raw_data")
intermediate_data_path <- here(data_path, "intermediate_data")

# country
US_raw_data_path <- here(raw_data_path, "US")
US_intermediate_data_path <- here(intermediate_data_path, "US")

UK_raw_data_path <- here(raw_data_path, "UK")
UK_intermediate_data_path <- here(intermediate_data_path, "UK")

FR_raw_data_path <- here(raw_data_path, "FR")
FR_intermediate_data_path <- here(intermediate_data_path, "FR")

# database
US_txt_raw_data_path <- here(US_raw_data_path, "AEA_JEL", "txt")
US_txt_intermediate_data_path <- here(US_intermediate_data_path, "txt")

US_pq_raw_data_path <- here(US_raw_data_path, "proquest")

UK_ethos_raw_data_path <- here(UK_raw_data_path, "ethos")
UK_ethos_intermediate_data_path <- here(UK_intermediate_data_path, "ethos")

FR_thesefr_raw_data_path <- here(FR_raw_data_path, "these_fr")
FR_thesefr_intermediate_data_path <- here(FR_intermediate_data_path, "these_fr")

FR_sudoc_raw_data_path <- here(FR_raw_data_path, "sudoc")
FR_sudoc_intermediate_data_path <- here(FR_intermediate_data_path, "sudoc")

FR_cleaned_data_path <- here(data_path, "cleaned_data/FR")

# Why saving this in the data file?? It should be in the project repo no?
# figures_path <- here(data_path, "figures")



```

# Introduction

This database gathers information on Ph.D. in economics defended in France since 1900. The project is part of a broader initiative entitled *Becoming an economists* that aim at building a comprehensive database of Ph.D. in economics across the world. The project is developed by Thomas Delcey and Aurélien Goutsmedt.

The output of the french database is a relational database that connects different data frames. The database is structured in four main components:

-   **Thesis Metadata:** This component contains core details about each thesis. Each line represents a thesis record, including information such as the title, defense date, abstract, and other relevant details.
-   **Edges:** This table links the three previous tables, allowing to connect individuals to institutions and to theses.
-   **Institutions Data:** This includes all mentioned universities, laboratories, doctoral schools, and other institutions associated with the theses.
-   **Individual Data:** Each line represents an individual involved in the thesis, such as authors, supervisors, or jury members.

WHY IN ENGLISH

# Method

We relies on two principles to build this database:

-   **no data transformation**: our work is mainly a data collection, categorization, and cleaning work. We tried as less as possible to transform the data or limit the transformation to minimal and impactless transformation. To put it differently, we did not touch the cell values of the original data, mainly the encoded variables.

-   **disambiguation**: we tried to disambiguate the entities (thesis, authors, etc.) as much as possible. Disambiguation refers to the process of identifying and distinguishing between different entities that may have the same name. We tried to provide a unique identifier for each entity. The identifiers of the Agence Bibliographique de l’Enseignement Supérieur (ABSES) was the main source of unique identifiers (idref, nnt, etc.). When their identifiers were not available or disambiguaion was not possible, we created our own temporary unique identifiers.

# Presentation of the tables

## Thesis Metadata

```{r}
#| echo: FALSE

thesis_metadata <- readRDS(here(FR_intermediate_data_path, "thesis_metadata.RDS")) %>% ungroup
```

The thesis metadata table contains `r ncol(thesis_metadata)` variables:

-   `thesis_id`: the unique identifier of the thesis. If it exists, it is the officiel "national number of the thesis" created by the Agence Bibliographique de l'Enseignement Supérieur (ABES) and the theses.fr website. If not, it is a temporary identifier we have created.
-   `year_defence`: the date of the defence of the thesis. It covers the period between `r min(thesis_metadata$year_defence, na.rm = TRUE)` and `r max(thesis_metadata$year_defence, na.rm = TRUE)`.
-   `language_1` and `language_2` are the languages of the thesis. It is a harmonized variables of the respective language variables found in SUDoc and These.fr.
-   `title_fr`: the title of the thesis in French.
-   `title_en`: the title of the thesis in English.
-   `title_other`: the title of the thesis in another language.
-   `abstract_fr`: the abstract of the thesis in French.
-   `abstract_en`: the abstract of the thesis in English.
-   `abstract_other`: the abstract of the thesis in another language.
-   `field`: the field of the thesis. It is a harmonized variable of the respective field variables found in SUDoc and These.fr.
-   `accessible`: a binary variable indicating whether the fulltext is accessible or not.
-   `type`: the type of the thesis. Type can take `r n_distinct(thesis_metadata$type)` values: `r unique(thesis_metadata$type)`. All categories are categories found in SUDoc (see @tip-type).
-   `country`: the country where the thesis was defended (à supprimer ?)
-   `url`: the url of the thesis, linking to the theses.fr website or the sudoc.fr website.

::: {#warning-language .callout-warning}
Raw source data had an important rate of error in the title and abstract language: title in french were in the english column and vice versa. We have corrected this issue by using a language prediction model. The model is based on a combination of language predictive models to predict the language of abstracts and relocate abstracts in proper columns. See @sec-cleaning-metadata for details.
:::

@tbl-metadata shows a sample of the thesis metadata table. The thesis metadata table contains `r nrow(thesis_metadata)` theses. @fig-metadata_distribution shows the distribution of theses over time.

```{r}
#| echo: FALSE
#| label: tbl-metadata
#| tbl-cap: "Sample of the metadata table"

thesis_metadata %>% 
 # sample random line 
  slice_sample(n = 50) %>% 
  mutate(abstract_fr = str_trunc(abstract_fr, 50),
         abstract_en = str_trunc(abstract_en, 50),
         title_fr = str_trunc(title_fr, 50),
         title_en = str_trunc(title_en, 50)) %>% 
  DT::datatable(
    rownames = FALSE,
    options = list(
      pageLength = 5,
      scrollX = TRUE
    )
  ) %>% 
  DT::formatStyle(columns = colnames(.), fontSize = '50%')


```

::: panel-tabset
### Distribution

```{r}
#| echo: FALSE
#| label: fig-metadata_distribution
#| fig.cap: "Distribution of theses by defense date"

p <- thesis_metadata %>% 
  count(year_defence) %>%
  mutate(tooltip = glue::glue("Defense date: {year_defence} <br> Number of theses: {n}")) %>% 
  ggplot(aes(x = year_defence, y = n, text = tooltip)) +
  geom_col(fill = "skyblue", position = "stack") +
  labs(title = "Distribution of theses by defense date",
       x = "Defense date",
       y = "Number of theses") +
  theme_minimal() 

p %>% 
  plotly::ggplotly(tooltip = "text")

```

### Distribution by type of thesis

```{r}
#| echo: FALSE
#| label: fig-metadata_distribution_type
#| fig.cap: "Distribution of theses by defense date and type of thesis"


p <- thesis_metadata %>% 
  count(year_defence, type) %>%
  mutate(tooltip = glue::glue("Defense date: {year_defence} <br> Type: {type} <br> Number of theses: {n}")) %>%
  ggplot(aes(x = year_defence, y = n, fill = type, text = tooltip)) +
  geom_col(position = "stack") +
  labs(title = "Distribution of theses by defense date and type of thesis",
       x = "Defense date",
       y = "Number of theses",
       fill = "Type of thesis") +
  theme_minimal() 


p %>% 
  plotly::ggplotly(tooltip = "text")
```
:::

::: {#tip-type .callout-note}
### Type of theses in the French system

Note that the French education system did not have a harmonized Ph.D. system between the early 1960s and 1984, date of the Sauvy reform that harmonized the Ph.D. system. During this period, various types of theses existed before. It was usual in the mid 1970s to start with a "Doctorat de 3e cycle" before making a "Doctorat d'Etat". Thus, one author can have several types of theses. @fig-metadata_distribution_type shows the distribution of theses over time by the type of thesis.
:::

## Edges

```{r}
#| echo: FALSE

thesis_edge <- readRDS(here(FR_intermediate_data_path, "thesis_edge.rds")) %>% ungroup
```

Each line in the edge table is a unique edge between a thesis and an entity. We define entity as any individual or institution involved in the thesis. The edge table has `r ncol(thesis_edge)`:

-   `thesis_id`: the identifiers of a thesis (the same than in `thesis_medata`). In the edge table, a `thesis_id` can have several edges. A `thesis_id` has at least two edges: the author and the institution in which the thesis was defended.
-   `entity_id`: the identifiers of an entity.
-   `entity_role`: the role of the entity. A person can be either an author, a supervisor, a referee, a president or a member of jury. In addition to the main institution in which the Ph.D. was defended, the `entity_role` can contain additional information we were able to collect such as the other institutions, laboratories, doctoral schools (the institution organizing the doctorate in french university). Note that it concerns only theses collected in these.fr after 1985. For SUDoc, the value `etablissements_soutenance_from_info` may provide additional information on the institution.
-   `entity_firstname`: The name of the entity. Each entity has a `entity_name`. Note that the entity identifiers is unique but the entity name is not unique. For instance, two different persons can have the same name. When available, an individual can have a `entity_firstname`.

::: {#warning-edges .callout-warning}
Most of our effort in building the database was to delete duplicates in entities so that users can easily estimate the involvement of an entity in theses. It is the case for most institutions which are well identified by an unique idref. Unfortunately, it was impossible to disambiguous all entities for individuals. To illustrate this point, it is very easy to spot that the string "Paris I" and "Paris I Panthéon-Sorbonne" are the same entity but we cannot be sure that "Thomas Delcey" authoring a Ph.D in 2021 is the same person than "Thomas Delcey" supervising a Ph.D. in 2022. The variable `homonym_of` allows the user to spot potential duplicates. See details in @sec-cleaning-persons.
:::

@tbl-edges shows a sample of the thesis edge table. We identify `r nrow(thesis_edge)` edges in total. @fig-person-role shows the distribution of individuals by role. @fig-person-institution shows the distribution of individuals for the top institutions.

```{r}
#| echo: false
#| label: tbl-edges
#| tbl-cap: "Sample of the edges table"


thesis_edge %>% 
 # sample random line 
  slice_sample(n = 50) %>% 
  DT::datatable(
    rownames = FALSE,
    options = list(
      pageLength = 5,
      scrollX = TRUE
    )
  ) %>% 
  DT::formatStyle(columns = colnames(.), fontSize = '50%')

```

::: panel-tabset
### Top roles

```{r}
#| echo: FALSE
#| label: fig-person-role 
#| fig.cap: "Top role"

p <- thesis_edge %>% 
  filter(str_detect(entity_role, "auteur|directeurs|jury|rapporteurs")) %>% 
  count(entity_role) %>% 
  mutate(entity_role = reorder(entity_role, n)) %>%
  mutate(tooltip = glue::glue("Role: {entity_role} <br> Number of individuals: {n}")) %>% 
  ggplot(aes(x = entity_role, y = n, text = tooltip)) +
  geom_col(fill = "skyblue") +
  coord_flip() +
  labs(x = "",
       y = "Number of individuals") +
  theme_minimal()

p %>% 
  plotly::ggplotly(tooltip = "text")

```

### Top institutions

```{r}
#| echo: FALSE
#| label: fig-person-institution
#| fig.cap: "Top role"

thesis_edge %>% 
  filter(!str_detect(entity_role, "auteur|directeurs|jury|rapporteurs")) %>% 
  count(entity_id, entity_name) %>% 
  slice_max(n, n = 10) %>% 
  mutate(entity_name = reorder(entity_name, n)) %>%
  ggplot(aes(x = entity_name, y = n)) +
  geom_col(fill = "skyblue") +
  coord_flip() +
  labs(x = "",
       y = "Number of individuals") +
  theme_minimal()
```
:::

## Institutions

```{r}
#| echo: FALSE
thesis_institution <- readRDS(here(FR_cleaned_data_path, "thesis_institution.rds")) %>% ungroup
```

The thesis institution table contains `r nrow(thesis_institution)` institutions. Institutions are the universities, laboratories, doctoral schools, and other institutions associated with the theses.

The thesis institution table contains `r ncol(thesis_institution)` variables. It consists of two core variables:

-   `entity_id`: the unique identifier of the entity (here the institution).
-   `entity_name`: the name of the entity.

The other variables are additional information on the institution provided by the IdRef database:

-   `url`: the url of the entity.
-   `scraped_id`: the identifier of the entity in the scraped data.
-   `pref_name`: the preferred name of the entity.
-   `other_labels`: other labels of the entity.
-   `country`: the country of the entity.
-   `date_of_birth`: the date of birth of the entity.
-   `date_of_death`: the date of death of the entity.
-   `information`: additional information on the entity.
-   `replaced_idref`: the identifier of the entity that replaced the entity.
-   `predecessor`: the predecessor of the entity.
-   `predecessor_idref`: the identifier of the predecessor of the entity.
-   `successor`: the successor of the entity.
-   `successor_idref`: the identifier of the successor of the entity.
-   `subordinated`: the subordinated entity.
-   `subordinated_idref`: the identifier of the subordinated entity.
-   `unit_of`: the unit of the entity.
-   `unit_of_idref`: the identifier of the unit of the entity.
-   `other_link`: other links of the entity.
-   `info`: additional information on the entity.
-   `country_name`: the country name of the entity.

@tbl-institution shows a sample of the thesis institution table.

```{r}
#| echo: FALSE
#| label: tbl-institution
#| tbl-cap: "Sample of the thesis institution table"

thesis_institution %>% 
  slice_sample(n = 5) %>% 
  DT::datatable(
    rownames = FALSE,
    options = list(
      pageLength = 5,
      scrollX = TRUE
    )
  )

```

## Individuals

```{r}
#| echo: FALSE
thesis_person <- readRDS(here(FR_cleaned_data_path, "thesis_person.rds"))
```

The thesis person table contains `r ncol(thesis_person)` variables. The four core variables are:

-   `entity_id`: the unique identifier of the individual.
-   `entity_name`: the name of the individual.
-   `entity_firstname`: the first name of the individual.
-   `gender`: the gender of the individual according to the IdRef database.
-   `gender_expanded`: the gender of the individual according to the IdRef database augmented for missing values with the French census data (see details in @sec-cleaning-institutions).

The other variables are additional information on the individual provided by the IdRef database:

-   `birth`: the birth date of the individual.
-   `country`: the country of the individual.
-   `info`: additional information on the individual.
-   `organization`: the organization of the individual.
-   `last_date_org`: the last date of the organization.
-   `start_date_org`: the start date of the organization.
-   `end_date_org`: the end date of the organization.
-   `other_link`: other links of the individual.
-   `country_name`: the country name of the individual.
-   `homonym_of`: the identifier of the homonyms in the database.

@tbl-person shows a sample of the thesis metadata table.

```{r}
#| echo: FALSE
#| label: tbl-person
#| tbl-cap: "Sample of the thesis person table"

thesis_person %>% 
  slice_sample(n = 5) %>% 
  DT::datatable(
    rownames = FALSE,
    options = list(
      pageLength = 5,
      scrollX = TRUE
    )
  )

```

::: panel-tabset
### Gender

```{r}
#| echo: FALSE
#| label: fig-person_genre
#| fig.cap: "Distribution of individuals by gender"


p <- thesis_person %>%
  mutate(gender_expended = ifelse(is.na(gender_expended), "Unknown", gender_expended)) %>% 
  mutate(total = n()) %>% 
  add_count(gender_expended) %>% 
  reframe(percentage = n/total*100,
          tooltip = glue::glue("Gender: {gender_expended} <br> Number of theses: {n} <br> % : {round(percentage, 2)}"),
          gender_expended) %>%
  unique %>% 
  ggplot(aes(x = gender_expended, y = percentage, text = tooltip)) +
  geom_col(fill = "skyblue") +
  labs(y = "") + 
  theme_minimal() 

p %>% 
  plotly::ggplotly(tooltip = "text")
  
  
  
```

### Country

```{r}
#| echo: FALSE
#| label: fig-person_country
#| fig.cap: "Distribution of individuals by country (top 10 excluding France)"


thesis_person %>%
  mutate(country_name = ifelse(is.na(country_name), "Unknown", country_name)) %>%
  count(country_name) %>% 
  filter(country_name != "Unknown" & country_name != "France") %>% 
  slice_max(n, n = 10) %>%
  # arrange 
  mutate(country_name = reorder(country_name, n)) %>%
  ggplot(aes(x = country_name, y = n)) +
  geom_col(fill = "skyblue") +
  coord_flip() +
  labs(x = "",
       y = "Number of individuals") +
  theme_minimal()

```
:::

# Data collection and cleaning process

## General presentation

```{r}
# Load the DiagrammeR package
p_load(DiagrammeR)

# Define the graph
grViz("
digraph project_dag {
 graph [layout = dot, rankdir = TB]
 
 # Define nodes
 scraping_sudocc_id [label = 'scraping_sudoc_id.R', shape = box, style = filled, fillcolor = lightblue]
 scraping_sudoc_api [label = 'scraping_sudoc_api.R', shape = box, style = filled, fillcolor = lightblue]
 cleaning_SUDoc[label = '1_FR_sudoc_cleaning.R', shape = box, style = filled, fillcolor = lightyellow]
 downloading_theses_fr [label = 'downloading_theses_fr.R', shape = box, style = filled, fillcolor = lightblue]
 cleaning_thesesfr [label = '2_FR_thesesfr_cleaning.R', shape = box, style = filled, fillcolor = lightyellow]
 merging_database [label = '3_FR_merging_database.R', shape = box, style = filled, fillcolor = lightyellow]
 idref_institutions [label = 'scraping_idref_institution.R', shape = box, style = filled, fillcolor = lightblue]
 idref_persons [label = 'scraping_idref_person.R', shape = box, style = filled, fillcolor = lightblue]
 cleaning_metadata [label = '4_FR_cleaning_thesis_metada.R', shape = box, style = filled, fillcolor = lightyellow]
 cleaning_institutions [label = '5_FR_cleaning_institutions.R', shape = box, style = filled, fillcolor = lightyellow]
 cleaning_persons [label = '6_FR_cleaning_persons.R', shape = box, style = filled, fillcolor = lightyellow]
 cleaning_edges [label = '7_FR_cleaning_edges.R', shape = box, style = filled, fillcolor = lightyellow]
 
 # Define edges
 scraping_sudoc_id -> scraping_sudoc_api
 scraping_sudoc_api -> cleaning_sudoc 
 downloading_theses_fr -> cleaning_thesesfr
 cleaning_sudoc-> merging_database
 cleaning_thesesfr -> merging_database
 merging_database -> idref_institutions
 merging_database -> idref_persons
 merging_database -> cleaning_metadata
 idref_institutions -> cleaning_institutions
 idref_persons -> cleaning_persons
 cleaning_metadata -> cleaning_edges
 cleaning_institutions -> cleaning_edges
 cleaning_persons -> cleaning_edges
}
")

```

## Data sources

The data used in this project comes from three mains sources:

-   **Theses.fr:** <https://theses.fr/>
-   **SUDoc:** <https://www.sudoc.fr/>
-   **IdRef:** <https://www.idref.fr/>

These sources are the result of the work of the [ABES](https://abes.fr/l-abes/presentation/) (l'Agence bibliographique de l'enseignement supérieur) who produced metadata and APIs regarding research and superior education. The data of the three sources mentionned above are under the [Etabab "Open Licence"](https://www.etalab.gouv.fr/licence-ouverte-open-licence/).[^1]

[^1]: See the English description of the licence [here](https://www.etalab.gouv.fr/wp-content/uploads/2018/11/open-licence.pdf).

### Theses.fr:

[Theses.fr](https://theses.fr/) is a comprehensive repository for PhD dissertations defended in French institutions since 1985.[^2] It includes metadata such as the title of the dissertation, author, date of defense, institution, supervisor, abstract, etc.. The database covers a wide range of disciplines, providing access, in some cases, to digital theses.

[^2]: This corresponds to the reform of French PhD and the implementation of the "new regime".

### SUDoc (Système Universitaire de Documentation):

[SUDoc](https://www.SUDoc%20.fr/) is a union catalog that includes references to various documents held in French academic and research libraries. It covers books, journal articles, dissertations, and other academic works. The SUDoc database includes metadata like title, author, publication date, and library locations where the documents can be found. It's a key resource for academic research in France, providing a broad overview of available scholarly materials. Regarding PhD, it allows to find dissertations defended before 1985, and to recover relevant metadata.

### IdRef (Identifiants et Référentiels pour l'Enseignement supérieur et la Recherche):

[IdRef](https://www.idref.fr/) is a database focused on managing and standardizing the names and identifiers of authors and other contributors to academic and research works. It provides authority control for names used in academic cataloging, ensuring consistency and aiding in accurate attribution of works. IdRef is used in conjunction with SUDoc and other databases to support the management of bibliographic data in the French higher education and research sectors. In our project, it allows us to find additional data on individuals and institutions.

## Data collection

## theses.fr

Theses records are registered in [theses.fr](https://theses.fr/) since 1985. Theses.fr data are also stored on [data.gouv.fr](https://www.data.gouv.fr/fr/datasets/theses-soutenues-en-france-depuis-1985/#/resources) website. They can be downloaded directly at this [URL](https://www.data.gouv.fr/fr/datasets/r/eb06a4f5-a9f1-4775-8226-33425c933272). The [downloading_theses_fr.R](../scripts/scraping_scripts/FR/downloading_theses_fr.R) script allows to download the `.csv` on data.gouv and to compress and store it in `.rds` format.

## SUDoc

```{r}
urls_econ <- readRDS(here(FR_sudoc_raw_data_path, glue("sudoc_urls_economics_1900-1985.RDS")))
urls_law <- readRDS(here(FR_sudoc_raw_data_path, glue("sudoc_urls_law_1900-1968.RDS")))
```

We systematically collect metadata on French dissertations archived in the [SUDoc](https://www.SUDoc%20.fr/) database, focusing on theses in economics through two distinct query strategies:

-   First query: We search for dissertations with a term starting with "econo" in the "Note de Thèse" field, which denotes the thesis discipline. This keyword captures terms like "économie" or "Economique" since SUDoc 's search function is case-insensitive and ignores accents. The time frame is limited to 1900–1985, as dissertations from later years are systematically cataloged in [Theses.fr](https://theses.fr/). [Here is the query](https://www.SUDoc%20.abes.fr/cbs//DB=2.1/SET=28/TTL=10/CMD?ACT=SRCHM&MATCFILTER=Y&MATCSET=Y&NOSCAN=Y&PARSE_MNEMONICS=N&PARSE_OPWORDS=N&PARSE_OLDSETS=N&IMPLAND=Y&ACT0=SRCHA&screen_mode=Recherche&IKT0=63&TRM0=econo*&ACT1=-&IKT1=63&TRM1=&ACT2=%2B&IKT2=63&TRM2=&ACT3=%2B&IKT3=4&TRM3=&SRT=YOP&ADI_TAA=&ADI_LND=fr&ADI_JVU=1900-1985&ADI_MAT=Y&ILN_DEP_BIB=DEP&NOT_USED_ADI_BIB=+), allowing to retrieve `r cat(length(urls_econ))` thesis records.

-   Second query: We search for dissertations where "droit" (law) is specified in the "Note de Thèse" field, and where a term starting with "econo" appears in the title. This search is limited to 1900-1968 to capture dissertations classified as law theses before 1968 that likely focus on economics. [Here is the query](https://www.SUDoc%20.abes.fr/cbs//DB=2.1/SET=31/TTL=1/CMD?ACT=SRCHM&MATCFILTER=Y&MATCSET=Y&NOSCAN=Y&PARSE_MNEMONICS=N&PARSE_OPWORDS=N&PARSE_OLDSETS=N&IMPLAND=Y&ACT0=SRCHA&screen_mode=Recherche&IKT0=63&TRM0=droit&ACT1=*&IKT1=4&TRM1=econo*&ACT2=%2B&IKT2=63&TRM2=&ACT3=%2B&IKT3=1016&TRM3=&SRT=YOP&ADI_TAA=&ADI_LND=fr&ADI_JVU=1900-1968&ADI_MAT=Y&ILN_DEP_BIB=DEP&NOT_USED_ADI_BIB=+), allowing to retrieve `r cat(length(urls_law))` thesis records.

The [scraping_sudoc_id.R](../scripts/scraping_scripts/FR/scraping_SUDoc%20_id.R) collects the thesis records URLs. Then, the [scraping_sudoc_api.R](../scripts/scraping_scripts/FR/scraping_SUDoc%20_api.R) allows to query the [SUDoc API](https://api.gouv.fr/documentation/api-SUDoc) to retrieve structured metadata for each thesis, including information such as title, author, defence date, abstract, supervisor and other relevant details. These metadata are stored in an `.xml` file, which we then parse to extract the relevant information. The `.xml` is structured according to "tags" and "codes" that are explained [here](https://documentation.abes.fr/SUDoc%20/manuels/administration/aidewebservices/index.html#SUDoc%20MarcXML).

## IdRef

The [IdRef](https://www.idref.fr/) platform serves as a rich repository of structured metadata for individuals and institutions linked to academic records in France, particularly those cataloged in SUDoc and Thèses.fr. By leveraging unique IdRef identifiers, we can extract detailed information about individuals (e.g., date of birth, nationality, gender, last known institutions) and institutions (e.g., institutions preferred and alternate names, years of existence) involved in the Ph.D. graduating process. This helps to standardize individuals and institutions names and to ensure consistency and complete missing information for certain theses records.

## Data cleaning

Our data-cleaning approach focuses on ensuring consistency and quality while preserving the integrity of the original data. Key information, such as the institution of the thesis, is standardized to facilitate analysis. However, we keep this standardized data separate from the raw data, ensuring transparency in our modifications and avoiding any loss of original information.

The first step of the cleaning process involves merging data extracted from [Theses.fr](https://theses.fr/) and [SUDoc](https://www.SUDoc%20.fr/). We ensure compatibility in the metadata format and structure, allowing for a seamless integration of the two datasets. After merging, the dataset is organized into three main components:

-   Thesis Metadata: This component contains core details about each thesis. Each line represents a thesis record, including information such as the title, defense date, abstract, and other relevant details.
-   Individual Data: Each line represents an individual involved in the thesis, such as authors, supervisors, or jury members.
-   Institutions Data: This includes all mentioned universities, laboratories, doctoral schools, and other institutions associated with the theses.

This relational database connecting different data frames facilitates well-structured, accurate analysis across different dimensions of the dataset (see the [Description of the database](#description) section for details on the final content of the database).

### Cleaning SUDoc data

The cleaning process for SUDPC data in [1_FR_sudoc_cleaning.R](/scripts/cleaning_scripts/FR/1_FR_SUDoc%20_cleaning.R) is designed to address inconsistencies, remove duplicates, and standardize information across the dataset. This step aims to correct errors and inconsistencies linked to the SUDoc extraction, as well as to allows the consistency and merging with theses.fr data. Further cleaning steps are necessary and implemented after this merging.

#### Duplicate Management

The cleaning process first identifies and resolves duplicate records, which fall into two categories:

-   True duplicates: These occur when the same thesis is listed multiple times with identical identifiers and authors but differing defence dates. The process retains the most recent record as it is more likely to reflect the correct metadata.
-   False duplicates: These occur when the same identifier is shared by different authors, often due to data entry errors. To resolve these, unique identifiers are created by appending a counter to the nnt, ensuring data integrity without introducing ambiguity.

#### Date Standardization

Defence dates (`year_defence`) are cleaned and standardized by: - Choosing the oldest date for theses with multiple dates, as the earliest date is more likely to reflect the actual defence event. - Flagging and logging anomalous dates outside the query range (1899–1985) or those with large gaps between associated dates for manual inspection.

This approach minimizes errors stemming from incomplete or conflicting date records and ensures chronological accuracy.

#### Standardization of thesis types and Languages

Thesis types are deduplicated and recoded into consistent categories (e.g., "Thèse d'État", "Thèse de 3e cycle"). Records that are not doctoral theses (e.g., master's dissertations) are filtered out to focus exclusively on relevant entries. Similarly, language codes are standardized to align with ISO conventions and ensure compatibility with related datasets.

#### Output Preparation

The final dataset is split into four distinct outputs:

-   Metadata Table: Core information about theses, such as titles, abstracts, dates, and types.
-   Edge Table: Links between theses and associated entities (individuals and institutions).
-   Person Table: A unique list of individuals involved in theses (authors, jury members, etc.).
-   Institution Table: A unique list of institutions linked to theses (universities, laboratories, etc.).

By structuring the cleaned data in this way, the workflow facilitates downstream analysis, such as network modeling and bibliometric studies, while maintaining transparency in data transformations. This cleaning pipeline ensures the dataset's reliability and usability for academic and research purposes.

### Cleaning Theses.fr data

The [2_FR_thesesfr_cleaning.R](/scripts/cleaning_scripts/FR/2_FR_thesesfr_cleaning.R) is dedicated to cleaning and structuring metadata for theses related to economics extracted from the Theses.fr database. The primary goal is to prepare the dataset for integration with SUDoc data.

The cleaning process begins with filtering the dataset to retain only theses categorized under economics disciplines. A simple keyword search (e.g., "econom" or "économ") identifies potential entries, followed by the exclusion of specific fields unrelated to economics (e.g., legal or geographic disciplines, like "Droit économique"). Additionally, basic data quality checks ensure that all entries have valid and unique identifiers (nnt) to prevent issues during downstream processing.

The cleaned dataset is then divided into structured components for better usability. The metadata table (thesesfr_metadata) includes core thesis attributes such as titles, abstracts, defense dates, and disciplines. The edge table (thesesfr_edge) captures relationships between theses and associated entities, including authors, jury members, and affiliated institutions. Separate tables for individuals (thesesfr_person) and institutions (thesesfr_institution) are derived from the edge table. Temporary IDs are generated for entities without official identifiers to facilitate later identification and disambiguation.

### Merging theses.fr and SUDoc data

The [3_FR_merging_database.R](/scripts/cleaning_scripts/FR/3_FR_merging_database.R) script consolidates data from the two primary sources, SUDoc and Theses.fr, to create unified datasets. The process involves merging metadata, relationships (edges), individuals, and institutions while resolving duplicate entries across sources. Metadata is harmonized by removing redundancies and retaining unique thesis identifiers. Edge tables are cleaned to link theses with associated individuals and institutions, ensuring consistent identifiers for entities that appear in both databases. Separate tables for individuals and institutions are deduplicated and aligned for further cleaning and standardization.

### Cleaning thesis metadata {#sec-cleaning-metadata}

The [4_FR_cleaning_thesis_metadata.R](/scripts/cleaning_scripts/FR/4_FR_cleaning_thesis_metadata.R) is designed to clean and standardize metadata for theses, with a primary focus on managing titles and abstracts. The modification implemented in this script directly transformed the original columns, but all transformations are checked by eye and does not change the informational content of the columns. More directly: it mainly corrects errors in the original recording of information in SUDOC and Theses.fr.

The script addresses several key challenges: - the normalization of formatting the titles and abstracts - the detection and imputation of missing values - the verification of language consistency and the reallocation of misplaced titles and abstracts - the identification of duplicate thesis records

A central component of the script is the cleaning of titles and abstracts. Titles and abstracts written in full uppercase are transformed into sentence case to enhance readability. Placeholder text and irrelevant symbols are also removed, with problematic entries replaced by missing values (NA).

For cases where either French or English titles and abstracts are missing, the script employs auxiliary columns originally scraped (`title_other` and `abstract_other`) to fill gaps when relevant. Indeed, language detection is used to validate these imputed values, leveraging both the [cld3](https://docs.ropensci.org/cld3/reference/cld3.html) [@R-cld3] and [fastText](https://mlampros.github.io/fastText/articles/language_identification.html) [@fastText2016b] models for robust identification.

Language consistency is verified across the metadata. Titles and abstracts are checked to ensure that French and English columns contain text matching their intended language. Discrepancies are resolved by reassigning text to the correct fields.

### Cleaning institutions {#sec-cleaning-institutions}

The [5_FR_cleaning_institution.R](/scripts/cleaning_scripts/FR/4_FR_cleaning_institution.R) script aims to standardize and improve the quality of institution data. So far, any institution names mentioned in the metadata have been extracted and stored in a separate table. This script focuses on cleaning and standardizing these names to ensure consistency and accuracy in the dataset. Our goal is to replace temporary institution identifiers (id_temp) we have created in [3_FR_merging_database.R](/scripts/cleaning_scripts/FR/3_FR_merging_database.R) with the official IdRef identifiers (id_ref) to ensure consistency and accuracy in the dataset.

This replacement relies on matching the institution names and thesis defense dates. The process accounts for historical changes in institutional structures (e.g., the splitting of the University of Paris after 1968), ensuring that ambiguous cases are handled carefully. The core of the script is a manually defined table that associates regular expressions (regex) for institution names with their corresponding idref identifiers. This table also includes the dates of creation (date_of_birth) and dissolution (date_of_death) of institutions to set clear boundaries for replacement. For instance, if an institution's name matches "University of Paris" and the thesis was defended before 1970, the identifier is replaced with that of the historic University of Paris, as it was the only university in Paris at the time.

This approach ensures that institution identifiers are accurate and consistent across the dataset, enabling robust analysis and interpretation of the data. We kept the temporary identifier and did not assign an idref institution names when we were enable to resolve the ambiguity. For instance, if the institution is the "University of Paris" for a thesis defended after 1968 (and that could be Paris 1, Paris 2, Paris 3, etc.) we kept the temporary identifier. Each ambigous entity name kept its temporary identifier even when the name is the same.

### Cleaning individuals {#sec-cleaning-persons}

The [6_FR_cleaning_persons.R](/scripts/cleaning_scripts/FR/5_FR_cleaning_persons.R) script focuses on standardizing and improving the quality of individual data.

First, this script processes and cleans data for individuals associated with theses by merging and normalizing information of persons (e.g., authors, supervisors, etc.) from the idref_person_table. When a name entity is associated to an idref identifier, the script adds supplementary information on the person provided by the IdRef database (organization, birth date, relevant links such as wikipedia pages, etc.).

Second, we try to clean and unify person identifiers. We know that the same person can have slightly different names (e.g., "Jean A. Dupont" and "Jean Dupont") or that the same person can have the same names but different identifiers. It is particularly the case for person present in both SUDoc and Theses.fr databases. For instance, the same person can be the author of a thesis in SUDoc and a member of the jury of another thesis. Contrary to institution tables, however, we are enable to replace temporary identifiers by idref identifiers for individuals because of the risk of homonyms. If two persons have the same name, we cannot be sure that they are the same person. Two authors of two different theses could have the same name or it could be the same person doing two theses.

To address this issue, we create a new column `homonym_of` that group potential homonyms. For each person, the variable `homonym_of` give the list of person identifiers that are her homonyms. a new column `homonym_of` that group potential homonyms. For each person, the variable `homonym_of` give the list of person identifiers that are her homonyms.

# Usage and Access

## Application to other disciplines

Note that we focus on Ph.D. in economics but the project has been run with a relatively general perspective in mind, meaning that our codes could be transferred easily to other projects focusing on other disciplines in France. Indeed, a few changes in a couple of scripts would allow easily to scrape and clean the data for other disciplines or subjects. It would just involve:

-   changing the SUDoc queries in [scraping_scrpits/scraping_SUDoc \_id.R](../scripts/scraping_scripts/FR/scraping_SUDoc%20_id.R).
-   changing the theses.fr queries in [cleaning_scripts/2_FR_thesefr_cleaning.R](../scripts/cleaning_scripts/FR/2_FR_thesefr_cleaning.R).

Since the rest of the code aimed at standardizing, cleaning and merging data, it can be applied to any queries. Don't hesitate to ask us for guidance if you are using our code to extract similar data.

# Future work and improvements
